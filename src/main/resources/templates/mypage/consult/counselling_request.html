<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <title>회원 정보</title>
    <script src="https://kit.fontawesome.com/3a29a769fa.js" crossorigin="anonymous"></script>
    <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css'>
    <link rel="stylesheet" href="/css/mypage.css">
    <link rel="stylesheet" href="/css/mypage_sang.css">
    <script src="/js/jquery-3.5.1.min.js"></script>
</head>

<body>
    <!-- partial:index.partial.html -->
    <section class="vbox">

        <!-- 상단 네비게이션 자리  -->
        <header class="bg-dark dk header navbar navbar-fixed-top-xs">
            <!--취업정보센터 링크 -->
            <div class="navbar-header aside-md">
                <a class="btn btn-link visible-xs" data-toggle="class:nav-off-screen,open" data-target="#nav,html"><i
                        class="fa fa-bars"></i></a>


                <a href="/" class="navbar-brand" data-toggle="fullscreen"><i class="fas fa-book-open"></i> </i>
                    취업정보센터</a>

                <a class="btn btn-link visible-xs" data-toggle="dropdown" data-target=".nav-user"><i
                        class="fa fa-cog"></i></a>
            </div>

            <ul class="nav navbar-nav navbar-right m-n hidden-xs nav-user">
                <!-- 알림표시 -->
                <!-- open으로 작동 -->
<!--                <li class="hidden-xs">-->
<!--                    <a href="#" class="dropdown-toggle dk" data-toggle="dropdown">-->
<!--                        <i class="fa fa-bell"></i>-->
<!--                        <span class="badge badge-sm up bg-danger m-l-n-sm count">2</span>-->
<!--                    </a>-->
<!--                    <section class="dropdown-menu aside-xl">-->
<!--                        <section class="panel bg-white">-->
<!--                            <header class="panel-heading b-light bg-light">-->
<!--                                <strong>확인하지 않은 <span class="count">2</span>개 알림</strong>-->
<!--                            </header>-->
<!--                            <div class="list-group list-group-alt animated fadeInRight">-->
<!--                                <a href="#" class="media list-group-item">-->
<!--                                    &lt;!&ndash; <span class="pull-left thumb-sm"><img src="images/avatar.jpg" alt="John said" class="img-circle"></span> &ndash;&gt;-->
<!--                                    <span class="media-body block m-b-none"> 알림보여주는 자리<br>-->
<!--                                        <small class="text-muted">10분</small>-->
<!--                                        <small class="text-muted">전</small>-->
<!--                                    </span>-->
<!--                                </a>-->
<!--                                <a href="#" class="media list-group-item">-->
<!--                                    <span class="media-body block m-b-none">알림보여주는 자리<br><small-->
<!--                                            class="text-muted">1일</small>-->
<!--                                        <small class="text-muted">전</small></span>-->
<!--                                </a>-->
<!--                            </div>-->

<!--                            <footer class="panel-footer text-sm">-->
<!--                                <a href="#" class="pull-right"><i class="fa fa-cog"></i></a>-->
<!--                                <a href="#notes" data-toggle="class:show animated fadeInRight">모든알림 보러가기</a>-->
<!--                            </footer>-->
<!--                        </section>-->
<!--                    </section>-->
<!--                </li>-->
                <!-- 로그아웃 드롭다운 메뉴 -->
                <!-- open -->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        <span> &nbsp; &nbsp;</span> [[${memberDTO.getUser_name}]] 님 <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu animated fadeInRight"> <span class="arrow top"></span>

                        <li> <a href="/mypage/consult/modify">회원 정보수정</a> </li>
                        <!-- <li> <a href=""> <span class="badge bg-danger pull-right">3</span> 알림 </a> </li>  -->
                        <li class="divider"></li>
                        <li><a sec:authorize="isAuthenticated()" href="/logout" >Logout</a> </li>
                    </ul>
                </li>
            </ul>
        </header>
        <!-- 상단 네비게이션 end -->

        <section>
            <section class="hbox stretch">
                <!-- .aside -->
                <!-- 왼쪽메뉴 -->
                <!-- nav-xs로 줄임 -->
                <aside class="bg-dark lter aside-md hidden-print " id="nav">
                    <section class="vbox">
                        <!--MY HOME-->
                        <header class="header bg-primary lter text-center clearfix">
                            <button type="button" class="btn btn-sm btn-dark btn-icon" title="New project">
                                <i class="fas fa-home"></i>
                            </button>
                            <div class="btn-group hidden-nav-xs">
                                <a href="">
                                    <button type="button" class="btn btn-sm btn-primary"
                                        style="font-size: 20px; margin-bottom: 10px;"></i> MY
                                        HOME

                                    </button>
                                </a>

                            </div>
                        </header>
                        <!-- MY HOME END -->
                        <section class="w-f scrollable">
                            <div class="slim-scroll" data-height="auto" data-disable-fade-out="true" data-distance="0"
                                data-size="5px" data-color="#333333">
                                <!-- aside nav -->
                                <div th:replace="mypage/consult/aside :: body"/>
                            </div>
                        </section>

                        <footer class="footer lt hidden-xs b-t b-dark">
                            <!-- 메뉴숨길때 btn-icon active -->
                            <a href="#nav" data-toggle="class:nav-xs" class="pull-right btn btn-sm btn-dark btn-icon ">
                                <i class="fa fa-angle-left text"></i>
                                <i class="fa fa-angle-right text-active"></i>
                            </a>
                            <div class="btn-group hidden-nav-xs">
                            </div>
                        </footer>
                    </section>
                </aside>

                <!-- /.aside -->
                <!-- 콘텐츠 자리 -->
                <section id="content">
                    <section class="vbox">
                        <section class="scrollable padder">
                            <!-- 밑에서부터 컨텐츠 넣으면 되용 -->
                            <div id="content-frame">
                                <!-- 메뉴제목자리 -->
                                <div id="title" style="margin-bottom: 1em;">
                                    <h1>상담 신청 내역</h1>
                                </div>
                                <!-- 주요컨텐츠 -->
                                <div id="main-content" style="height: 100vh;">
                                    <div id="sang-con">
                                        <div id="radio">
                                            <input type="radio" name="radio" id="allow1" value="전체" class="checkbox" checked>
                                            <label for="allow1" class="input-label radio">미승인</label>
                                            <input type="radio" name="radio" id="allow2" value="승인" class="checkbox">
                                            <label for="allow2" class="input-label radio">승인</label>
                                        </div>
                                        <table class="type07">
                                            <thead>
                                                <tr>
                                                    <th scope="cols">순번</th>
                                                    <th scope="cols">학생명</th>
                                                    <th scope="cols">상담 분야</th>
                                                    <th scope="cols">세부 분류</th>
                                                    <th scope="cols">신청 일시</th>
                                                    <th scope="cols">상태</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="enter" id="con_stay" th:each="con2 : ${stay.getDtoList()}">
                                                    <th scope="row">[[${con2.consult_num}]]</th>
                                                    <td>[[${con2.con_user_name}]]</td>
                                                    <td>[[${con2.type}]]</td>
                                                    <td>[[${con2.name}]]</td>
                                                    <td>[[${con2.consult_date}]]</br>[[${con2.consult_time}]]</td>
                                                    <td><input type="checkbox" class="check" name="check1"></td>

                                                </tr><tr class="enter" id="con_no" th:each="con : ${notAllow.getDtoList()}">
                                                    <th scope="row">[[${con.consult_num}]]</th>
                                                    <td>[[${con.con_user_name}]]</td>
                                                    <td>[[${con.type}]]</td>
                                                    <td>[[${con.name}]]</td>
                                                    <td>[[${con.consult_date}]]</br>[[${con.consult_time}]]</td>
                                                    <td><input type="checkbox" class="check" name="check1"></td>
                                                </tr>
                                                <tr class="ok" id="con_ok" th:each="con1 : ${allow.getDtoList()}">
                                                    <th scope="row">[[${con1.consult_num}]]</th>
                                                    <td>[[${con1.con_user_name}]]</td>
                                                    <td>[[${con1.type}]]</td>
                                                    <td>[[${con1.name}]]</td>
                                                    <td>[[${con1.consult_date}]]</br>[[${con1.consult_time}]]</td>
                                                    <td><input type="checkbox" class="check" name="check2"></td>
                                                </tr>

                                            </tbody>
                                        </table>
                                        <div id="selectAll-wrap">
                                            <input style="margin-left: 80px;" type="checkbox" name="animal"
                                                value="selectall" onclick='selectAll()' />
                                            <b>모두 체크</b>
                                            <button class="btn-q" id="delete" style="margin-left: 10px;">삭제</button>
                                            <button class="btn-q" id="allow" style="margin-left: 10px;">승인</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </section>
                    <a href="#" class="hide nav-off-screen-block" data-toggle="class:nav-off-screen"
                        data-target="#nav"></a>
                </section>
                <!-- 콘텐츠 END -->

                <aside class="bg-light lter b-l aside-md hide" id="notes">
                    <div class="wrapper">Notification</div>
                </aside>
            </section>
        </section>
    </section> <!-- Bootstrap -->
    <!-- App -->

</body>
<!-- partial -->
<script src="/js/mypage.js"></script>
<script>
    window.onload = function (){
        checkIndex=1;
    }
    let check;
    function selectAll() {
        if($('input[name=animal]').is(':checked')==true){          //자식 checkBox에 check적용
            $('input[name=check'+checkIndex+']').prop("checked",true);
        }
        else if($('input[name=animal]').is(':checked')==false) {
            $('input[name=check'+checkIndex+']').prop("checked", false);
        }
    }

    $('input[name=radio]').change(function (){
        let radioVal=($('input[name=radio]:checked')).val();
        $('input[name=animal]').prop("checked",false);
        $('input[name=check'+checkIndex+']').prop("checked", false);
        switch (radioVal) {
            case '전체':
                $('.enter').css('display','table-row');
                $('.ok').css('display','none');
                $('.no').css('display','none');
                $('#allow').css("display","inline-block");
                checkIndex=2;
                break;
            case '승인':
                $('.enter').css('display','none');
                $('.ok').css('display','table-row');
                $('.no').css('display','none');
                $('#allow').css("display","none");
                checkIndex=1;
                break;
        }
    })

    //상담사 상담
    let p;
    $('.btn-q').click(function() {
        p = $(this).text();
        switch (p) {
            case "삭제":
                suc_var=0;
                checked_length = $('.check:checked').length;
                for (i = 0; i < checked_length; i++) {
                    index = ($('.check').index($('.check:checked'))); //<<1개만 반환됨
                    ($('.check').eq(index)).prop("checked", false);
                    num = $('.check').eq(index).parent("td").parent("tr").find("th").text();  //해당 순번에 해당하는 열의 순번 저장
                    $.ajax({
                        url: "/remove/"+num,
                        type: "Delete",
                        contentType: "application/json; charset=utf-8",
                        success : function (result){
                            suc_var=1;
                            relocation();
                        },
                        error : function (err) {
                            alert("처리 실패");
                        }
                    })
                }
                if(suc_var==1) {
                    alert("처리되었습니다");
                }
                function relocation(){
                    window.location.href=location.href;
                }
                break;
            case "승인":
                ajax_url="/consult/counselling_request?result=ok"
                ajax_list = [];
                checked_length = $('.check:checked').length;
                for (i = 0; i < checked_length; i++) {
                    index = ($('.check').index($('.check:checked'))); //<<1개만 반환됨
                    ($('.check').eq(index)).prop("checked", false);
                    num = $('.check').eq(index).parent("td").parent("tr").find("th").text();  //해당 순번에 해당하는 열의 순번 저장
                    ajax_list.push(num);
                }
                $.ajax({
                    url: ajax_url,
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify(ajax_list),
                    success : function (result){
                        alert("처리되었습니다");
                        window.location.href=location.href;
                    },
                    error : function (err) {
                        alert("처리 실패");
                    }
                })
                break;
        }
        // ajax_list = [];
        // checked_length = $('.check:checked').length;
        // for (i = 0; i < checked_length; i++) {
        //     index = ($('.check').index($('.check:checked'))); //<<1개만 반환됨
        //     ($('.check').eq(index)).prop("checked", false);
        //     num = $('.check').eq(index).parent("td").parent("tr").find("th").text();  //해당 순번에 해당하는 열의 순번 저장
        //     ajax_list.push(num);
        // }
        // $.ajax({
        //         url: "/consult/counselling_request?result="+p,
        //         type: "POST",
        //         contentType: "application/json; charset=utf-8",
        //         dataType: "json",
        //         data: JSON.stringify(ajax_list),
        //         success : function (result){
        //             alert("처리되었습니다");
        //             // window.location.href=location.href;
        //             if(ListId == "content-frame" ||p=='ok') {
        //                 window.location.href="/mypage/consult/counselling_request?page1=&page2=&page3=&type=ok"
        //             }
        //             else if(ListId == "content-frame" || p=='no'){
        //                 window.location.href="/mypage/consult/counselling_request?page1=&page2=&page3=&type=no"
        //             }
        //             else if(ListId == "content-frame" || p=='stay'){
        //                 window.location.href="/mypage/consult/counselling_request?page1=&page2=&page3=&type=stay"
        //             }
        //         },
        //         error : function (err) {
        //             alert("상담목록 처리 실패");
        //         }
        //     })


    })
</script>
</body>

</html>